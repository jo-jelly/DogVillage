<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"https://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="team.Review.ReviewMapper"> <!-- 네임스페이스가 인터페이스 프로덕트맵퍼랑경로가같아야함 -->
   <select id="list" resultType="reviewVO"> <!-- id가 메서드명  resultType. 가져다쓸수잇음. 알리아스 걸어야함 -->
      <![CDATA[
      select * from (select rownum rnum, t1.* from
      (select * from Review where p_code = #{p_code} order by r_code) t1)
      where rnum >= #{start} and rnum <= #{end}    
      order by 
      r_code desc
      ]]>
   </select>
   
   <select id="totalCnt" resultType="java.lang.Integer">
      select count(*) from review
   </select>
   
   <select id="ptotalCnt" resultType="java.lang.Integer">
      select count(*) from review WHERE p_code=#{p_code}
   </select>

   <select id="detail" resultType="reviewVO" parameterType="java.lang.Integer"> 
      select * from Review where r_code = #{r_code} 
   </select> 

   

   <sql id="noMax">
      (select max(r_code)+1 from review)
   </sql> 
   
  
   <insert id="insert" parameterType="reviewVO">
      <selectKey keyProperty="r_code" resultType="java.lang.Integer" order="BEFORE">
         <include refid="noMax"/>
      </selectKey>
      insert into review 
      (r_code, p_code, id, r_title, r_content, r_image, r_regdate) 
      values
      (#{r_code}, #{p_code}, #{id}, #{r_title}, #{r_content}, #{r_image}, sysdate)
   </insert>
   

   <insert id="insertfirst" parameterType="reviewVO">
      insert into review 
      (r_code, p_code, id, r_title, r_content, r_image, r_regdate) 
      values
      (1, #{p_code}, #{id}, #{r_title}, #{r_content}, #{r_image}, sysdate)
   </insert>

   <update id="cnt" parameterType="java.lang.Integer">
         <![CDATA[
            update review set cnt = cnt+1 where r_code = #{r_code}
         ]]>
    </update>



   <update id="fileModify" parameterType="reviewVO"> <!--이미지수정-->
      update review set r_image = null where r_code = #{r_code}
   </update>
   <update id="modify" parameterType="reviewVO">
      update review set 
      r_title = #{r_title}, r_content = #{r_content},
      r_image = #{r_image}, 
      r_regdate = sysdate where r_code = #{r_code}
   </update>
   
      <select id="imgList" resultType="reviewVO" parameterType="java.lang.Integer">
      select * from review where r_code = #{r_code}
   </select>
   
   <delete id="delete" parameterType="reviewVO">
         delete from review where r_code = #{r_code}
   </delete>
   
   <select id="list_tp" resultType="TmsVO" >
      select * from tms where t_pid = #{pid} 
   </select>
   
   <select id="listName" resultType="ProductVO" >
      select * from product where p_name = #{name} 
   </select>

   <select id="Rtest" resultType="java.lang.Integer" >
           select count(*) from review WHERE p_code = #{p_code} AND id = #{id}
   </select>

   
</mapper>